let categoryColors=["rgba(255, 69, 0, 0.5)","rgba(0, 128, 0, 0.5)","rgba(30, 144, 255, 0.5)","rgba(255, 215, 0, 0.5)","rgba(0, 255, 255, 0.5)","rgba(255, 20, 147, 0.5)","rgba(0, 255, 0, 0.5)","rgba(70, 130, 180, 0.5)","rgba(255, 140, 0, 0.5)"];async function fetchAvgScores(){try{return await(await fetch("/get_average_scores/")).json()}catch(e){return console.error("Error fetching data:",e),null}}async function fetchTopPlayersData(){try{return await(await fetch("/get_top_players/")).json()}catch(e){return console.error("Error fetching top players data:",e),null}}async function renderBarChart(){var e,a=await(await fetch("/get_category_percentages/")).json();a&&(e=document.getElementById("barChart").getContext("2d"),new Chart(e,{type:"bar",data:{labels:a.categories,datasets:[{data:a.percentages,backgroundColor:["rgba(255, 69, 0, 0.8)","rgba(0, 128, 0, 0.8)","rgba(30, 144, 255, 0.8)","rgba(255, 215, 0, 0.8)","rgba(0, 255, 255, 0.8)","rgba(255, 20, 147, 0.8)","rgba(0, 255, 0, 0.8)","rgba(70, 130, 180, 0.8)","rgba(255, 140, 0, 0.8)"].slice(0,a.categories.length),borderColor:"rgba(255, 255, 255, 0.7)",borderWidth:1}]},options:{plugins:{legend:{display:!1},title:{display:!0,text:"Qué categorías interesan más? % partidas jugadas",font:{size:18,weight:"bold",family:"Arial, sans-serif"},color:"rgba(255, 255, 255, 0.85)",padding:{top:10,bottom:30}}},scales:{y:{beginAtZero:!0}}}}))}async function renderChart(){let a=await fetchAvgScores();var e;a&&(e=document.getElementById("myChart").getContext("2d"),new Chart(e,{type:"polarArea",data:{labels:a.labels,datasets:[{data:a.datasets[0].data,backgroundColor:categoryColors.slice(0,a.labels.length),borderColor:"rgba(255, 255, 255, 0.7)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){return a.labels[e.dataIndex]+": "+a.datasets[0].data[e.dataIndex].toFixed(2)}}},title:{display:!0,text:"Promedio global de puntos por categoría",font:{size:18,weight:"bold",family:"Arial, sans-serif"},color:"rgba(255, 255, 255, 0.85)",padding:{top:10,bottom:30}}},scales:{r:{ticks:{display:!0,backdropColor:"rgba(0, 0, 0, 0)",color:"white",font:{size:14}},pointLabels:{font:{size:14,weight:"bold"},color:"white"}}}}}))}async function renderRadarChart(){var t=["#FF6384","#FF9F40","#FFCD56"],r=await fetchTopPlayersData();if(r){var e=document.getElementById("myRadarChart").getContext("2d"),o=[],a=allCategories.map(e=>categoryNames[e]);for(let[e,a]of Object.entries(r.top_players)){var n=allCategories.map(e=>a.scores[e]||0);o.push({label:e,data:n,backgroundColor:t[o.length%t.length]+"30",borderColor:t[o.length%t.length],borderWidth:2,fill:!0})}new Chart(e,{type:"radar",data:{labels:a,datasets:o},options:{responsive:!0,scales:{r:{angleLines:{display:!0},suggestedMin:0,suggestedMax:100}},elements:{line:{tension:0}},plugins:{legend:{display:!0,labels:{font:{size:16,weight:"500"},color:"white"}},title:{display:!0,text:"Top 3 Jugadores global",font:{size:18,weight:"bold"},color:"rgba(255, 255, 255, 0.85)"}}}})}}document.addEventListener("DOMContentLoaded",function(){let a=document.getElementById("chart-container"),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(renderChart(),renderRadarChart(),renderBarChart(),t.unobserve(a))})});t.observe(a)});