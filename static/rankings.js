import{mostrarPinSiDisponible}from"./user-pins.js";let allScores=[],currentCategory="all",currentDateRange="all";async function getAllScores(t,a){try{let e="/get_all_scores/";return"all"!==t?e="all"!==a?`/get_all_scores_dates/${t}/`+a:"/get_all_scores/"+t:"all"!==a&&(e="/get_all_scores_dates/all/"+a),(await(await fetch(e)).json()).scores||[]}catch(e){return console.error("Error fetching scores:",e),[]}}function updateScores(e){displayScores("all"===currentCategory?e:e.filter(e=>e.category===currentCategory))}function displayScores(a){allCategories.forEach(t=>{var e="best-scores-"+t.toLowerCase(),e=document.getElementById(e);e&&(e.innerHTML="",populateScoreRows(a.filter(e=>e.category.toLowerCase()===t.toLowerCase()).slice(0,10),e))})}function displayFilteredScores(a){allCategories.forEach(t=>{var e="best-scores-"+t.toLowerCase(),e=document.getElementById(e);e&&(e.innerHTML="",populateScoreRows(a.filter(e=>e.category.toLowerCase()===t.toLowerCase()),e))})}function populateScoreRows(e,r){e.forEach(e=>{var t=document.createElement("tr");let a="";1===e.ranking?a='<img src="/static/svgs/gold.svg" alt="Medalla de Oro" width="20" height="20">':2===e.ranking?a='<img src="/static/svgs/silver.svg" alt="Medalla de Plata" width="20" height="20">':3===e.ranking&&(a='<img src="/static/svgs/bronze.svg" alt="Medalla de Bronce" width="20" height="20">'),t.innerHTML=`
            <td>${a}${e.ranking}</td>
            <td>
                <div class="name-avatar-cell">
                    <div class="avatar-small">
                        ${multiavatar(e.name)} <!-- Genera el avatar basado en el nombre -->
                    </div>
                    <span class="user-name">${e.name}</span>
                </div>
            </td>
            <td>${e.score}</td>
            <td>${e.total_correct}</td>
            <td>${e.avg_time}</td>
        `,r.appendChild(t)})}document.addEventListener("DOMContentLoaded",async()=>{mostrarPinSiDisponible(pin_code);var e=document.getElementById("category-selector"),t=document.getElementById("date-range-selector");updateScores(allScores=await getAllScores(currentCategory,currentDateRange)),e.addEventListener("change",async e=>{currentCategory=e.target.value,updateScores(allScores=await getAllScores(currentCategory,currentDateRange))}),t.addEventListener("change",async e=>{currentDateRange=e.target.value,updateScores(allScores=await getAllScores(currentCategory,currentDateRange))});var a,e=new URLSearchParams(window.location.search).get("search"),t=document.getElementById("search-input");let r=t=>{displayFilteredScores(allScores.filter(e=>e.name.toLowerCase().includes(t)))};e&&(a=e.toLowerCase(),t.value=e,r(a)),t.addEventListener("input",e=>{e=e.target.value.toLowerCase();e?r(e):updateScores(allScores)})});